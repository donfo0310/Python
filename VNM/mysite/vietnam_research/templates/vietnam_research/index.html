{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>VNMビューア</title>

    <!-- css -->
    <link rel="stylesheet" href="{% static 'vietnam_research/css/style.css' %}"> 

    <!-- chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="{% static 'vietnam_research/js/lineChart.js' %}" charset="utf-8"></script>

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3-path.v1.min.js" charset="utf-8"></script>
    <script src="{% static 'vietnam_research/js/radarChart.js' %}" charset="utf-8"></script>
</head>
<body>
    
    <h1>h1タイトルは非表示</h1>

    <!-- Django to Javascript -->
    <script>
        var data1 = [];
        var data1_inner = [];
        var data2 = [];
        var data2_inner = [];
    </script>
    {% for idx, row in industry.iterrows %}
        <script>
            data1_inner.push({axis: "{{ row.ind_name }}", value: "{{ row.cnt_per }}"})
            data2_inner.push({axis: "{{ row.ind_name }}", value: "{{ row.cap_per }}"})
        </script>
    {% endfor %}
    <script>
        // 数字のidxを変えて代入すると時点を変えたグラフを一緒に表示できる
        data1.push({name: '企業数', axes: data1_inner});
        data2.push({name: '時価総額', axes: data2_inner});
    </script>

    <h2>Todo</h2>
    <p>国の成長期に金融が稼げる理由は？</p>
    <p>
        データ:<br>
        証券コードから業種・会社名の取得<br>
        同業株価上位グラフ5位横並べ<br>
        セクター別リターン<br>
        個社利率<br>
        50万円で大口株主になれる先リスト<br>
        センチメント分析<br>
        配当性向<br>
        ニュース・有報から上方修正先を抽出<br>
        あと何株買えるの？の計算式（excelでやるやつ）をフォームで
    </p>
    <p>スクレイピング: 上場日</p>

    <h2>業種別マクロ分析</h2>
    <p>これで3年分ぐらいを重ねてみたい</p>
    <p>足元の鉱業の不調は、かつてベトナムの主力輸出品であった原油の生産量が原油価格低迷に伴い減少したことが主因と見られる。
        他方、足元で製造業の伸び率が加速している点については、ベトナムに進出した外資系企業による鉄鋼や電機製品などの生産が
        拡大したことに影響されたと見られる。中国やタイに比べて低いとされてきたベトナムの賃金は、近年、上昇が続いており、
        ベトナムに進出した日系企業にとって悩みの種となっている。<BR>
        <a href="https://www.murc.jp/wp-content/uploads/2018/03/report_180316.pdf">MURCベトナム経済の現状と今後の展望(20180316)</a>
    </p>
    <div class="radarChart1" style="display: inline-flex;"></div>
    <div class="radarChart2" style="display: inline-flex;"></div>
    <script>
        var margin = { top: 50, right: 130, bottom: 50, left: 80 };
        var radarChartOptions = {
            w: 290,
            h: 350,
            margin: margin,
            levels: 5,
            roundStrokes: true,
            color: d3.scaleOrdinal().range(['rgb(255,89,0)']), // orange"#ff5900"
            dotRadius: 3,
            format: '.2f',
            legend: { title: '業種別集計', translateX: 150, translateY: 40 },
            unit: '%'
        };
        RadarChart(".radarChart1", data1, radarChartOptions);
        RadarChart(".radarChart2", data2, radarChartOptions);
    </script>

    <h2>VN-Index（時系列）</h2>
    <p>底堅く上昇トレンド</p>
    <canvas id="vnChart" style="height:300px; width:1000px"></canvas>
    <h2>VN-Index（年単位ミルフィーユ）</h2>
    <p>季節要因は特に感じられない</p>
    <canvas id="vnChart_layer" style="height:300px; width:1000px"></canvas>
    {{ vnindex|json_script:"vnindex-json" }}
    <script>
        var vnidx = JSON.parse(document.getElementById('vnindex-json').textContent);
        var labelset = [];
        var dataset = [];
        var mm
        // time-line
        for (yyyy in vnidx) {
            for (let m = 1;  m <= 12;  m++) {
                mm = ('0' + m).slice(-2);
                labelset.push(yyyy + mm);
                dataset.push(vnidx[yyyy][mm]);
            }
        }
        LineChart('vnChart', labelset, [{
            label: 'VN-Index', 
            backgroundColor: 'rgba(255,89,0,0.3)', 
            borderColor: 'rgb(255,89,0)', 
            data: dataset
        }]);

        // time-line_layer
        var labelset_layer = [];
        var dataset_layer = [];
        var labelset_layer_inner = [];
        var dataset_layer_inner = [];
        var alpha = 0.1;
        for (yyyy in vnidx) {
            labelset_layer_inner = [];
            dataset_layer_inner = [];
            alpha += 1/Object.keys(vnidx).length;
            for (let m = 1;  m <= 12;  m++) {
                mm = ('0' + m).slice(-2);
                labelset_layer_inner.push(mm);
                dataset_layer_inner.push(vnidx[yyyy][mm]);
            }
            labelset_layer = labelset_layer_inner;
            dataset_layer.push({
                label: yyyy, 
                borderColor: 'rgba(255,89,0,' + alpha + ')', 
                fill: false, 
                data: dataset_layer_inner
            });
        }
        LineChart('vnChart_layer', labelset_layer, dataset_layer);

    </script>

    <h2>ドンから日本円へ</h2>
    ドンを200で割ると、ざっくり日本円になります。
    1,000don -> 5円

    <!-- 同業比較したいから、昇順keyつけてdbから出力 -->
    <!-- 上場日・主な事業・業種・ -->
    {% for idx, row in watchlist.iterrows %}
        <h2>{{ row.company_name }}</h2>
        <p>{{ row.bought_day }}, {{ row.stocks_price }}VND, {{ row.stocks_count }}株, {{ row.bikou }}</p>
        <img src="{% static 'vietnam_research/chart/' %}{{ row.symbol }}.png" alt="{{ row.symbol }}">
    {% endfor %}

    <h2>PERとは</h2>
    <img src="{% static 'vietnam_research/images/PER.png' %}" alt="PER">

    <h2>ベトナム基本情報</h2>
    <div class="basicinfo">
    {% for idx, row in basicinfo.iterrows %}
    <table><tbody>
        <tr>
            <th><p>{{ row.item }}</p></th>
            <td><p>{{ row.description }}</p></td>
        </tr>
    </tbody></table>
    {% endfor %}
    </div>

    <a href="https://www.jetro.go.jp/world/asia/vn/stat_01.html">基礎的経済指標（日本貿易振興機構 jetro.go.jp）</a>
    <p>※IMFデータをもとにSBI証券が作成を参考に</p>
    <p>ベトナム経済は人口ボーナス期の真っ最中</p>

</body>
</html>